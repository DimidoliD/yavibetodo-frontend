<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ya Vibe Todo</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            padding: 16px; 
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            padding-bottom: 80px;
        }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 24px; color: #2481cc; margin-bottom: 8px; }
        .tabs { 
            display: flex; 
            background: #f0f0f0; 
            border-radius: 10px; 
            padding: 4px; 
            margin-bottom: 20px; 
        }
        .tab { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            background: transparent; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
        }
        .tab.active { background: #2481cc; color: white; }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 16px; 
            margin-bottom: 20px; 
        }
        .stat-card { 
            background: #f8f8f8; 
            border-radius: 10px; 
            padding: 16px; 
            text-align: center; 
        }
        .stat-number { 
            font-size: 20px; 
            font-weight: bold; 
            color: #2481cc; 
            display: block; 
        }
        .stat-label { font-size: 12px; color: #666; margin-top: 4px; }
        .todo-item { 
            background: #f8f8f8; 
            border-radius: 10px; 
            padding: 16px; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: flex-start; 
            gap: 12px;
        }
        .todo-checkbox { 
            width: 20px; 
            height: 20px; 
            border: 2px solid #ccc; 
            border-radius: 50%; 
            cursor: pointer; 
            position: relative;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .todo-checkbox.checked { background: #2481cc; border-color: #2481cc; }
        .todo-checkbox.checked::after { 
            content: '‚úì'; 
            position: absolute; 
            color: white; 
            font-size: 12px; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
        }
        .todo-content { flex: 1; }
        .todo-title { font-size: 16px; margin-bottom: 4px; }
        .todo-meta { font-size: 12px; color: #666; }
        .badge { 
            display: inline-block; 
            padding: 2px 6px; 
            border-radius: 10px; 
            font-size: 10px; 
            margin-right: 4px; 
        }
        .badge-high { background: #ffe6e6; color: #d63031; }
        .badge-medium { background: #fff3cd; color: #e17055; }
        .badge-low { background: #d1f2eb; color: #00b894; }
        .badge-deadline { background: #e3f2fd; color: #0984e3; }
        .badge-overdue { background: #ffebee; color: #d63031; }
        .todo-actions { display: flex; gap: 8px; }
        .todo-action { 
            width: 28px; 
            height: 28px; 
            border: none; 
            background: transparent; 
            cursor: pointer; 
            border-radius: 4px;
        }
        .fab { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            width: 56px; 
            height: 56px; 
            border-radius: 50%; 
            background: #2481cc; 
            border: none; 
            color: white; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .modal { 
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0,0,0,0.5); 
            display: none; 
            align-items: center; 
            justify-content: center; 
            z-index: 2000; 
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content { 
            background: white; 
            border-radius: 10px; 
            width: 100%; 
            max-width: 400px; 
        }
        .modal-header { 
            padding: 20px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .modal-close { 
            width: 30px; 
            height: 30px; 
            border: none; 
            background: transparent; 
            cursor: pointer; 
            font-size: 18px;
        }
        .modal-body { padding: 20px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-input { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #eee; 
            border-radius: 8px; 
            font-size: 16px;
        }
        .priority-options { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
        }
        .priority-option { 
            padding: 10px; 
            border: 2px solid #eee; 
            border-radius: 6px; 
            text-align: center; 
            cursor: pointer; 
            font-size: 12px;
        }
        .priority-option.selected { border-color: #2481cc; background: #2481cc; color: white; }
        .btn { 
            padding: 12px 20px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px; 
            margin-right: 8px;
        }
        .btn-primary { background: #2481cc; color: white; }
        .btn-secondary { background: #eee; color: #333; }
        .empty-state { text-align: center; padding: 40px 20px; }
        .loading { text-align: center; padding: 40px; }
        .user-search { position: relative; }
        .search-results { 
            position: absolute; 
            top: 100%; 
            left: 0; 
            right: 0; 
            background: white; 
            border: 1px solid #eee; 
            border-radius: 6px; 
            max-height: 150px; 
            overflow-y: auto; 
            z-index: 100; 
            display: none;
        }
        .search-result { 
            padding: 10px; 
            cursor: pointer; 
            border-bottom: 1px solid #f0f0f0;
        }
        .search-result:hover { background: #f8f8f8; }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <button class="fab" onclick="openModal()">+</button>

    <!-- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ –±–µ–∑ –¥—É–±–ª–µ–π -->
    <div class="modal" id="todoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                    <input type="text" class="form-input" id="todoText" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?">
                </div>

                <div class="form-group">
                    <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <div class="priority-options">
                        <div class="priority-option" data-priority="high">üî• –í—ã—Å–æ–∫–∏–π</div>
                        <div class="priority-option selected" data-priority="medium">‚ö° –°—Ä–µ–¥–Ω–∏–π</div>
                        <div class="priority-option" data-priority="low">üå± –ù–∏–∑–∫–∏–π</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–î–µ–¥–ª–∞–π–Ω</label>
                    <input type="datetime-local" class="form-input" id="todoDeadline">
                </div>

                <div class="form-group">
                    <label class="form-label">–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</label>
                    <div class="delegation-hint">
                        üí° –í–≤–µ–¥–∏—Ç–µ @username —á—Ç–æ–±—ã –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∑–∞–¥–∞—á—É –∫–æ–ª–ª–µ–≥–µ
                    </div>
                    <div class="user-search">
                        <input type="text" class="form-input" id="assignToInput" 
                               placeholder="@username –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å–µ–±—è"
                               oninput="searchUsers(this.value)">
                        <div class="search-results" id="searchResults"></div>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 32px;">
                    <button class="btn btn-primary" onclick="saveTodo()">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
                    <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* --- JS –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–∞–∫ —É —Ç–µ–±—è --- */
        let app = {
            tg: window.Telegram?.WebApp,
            user: null,
            todos: [],
            assignedTasks: [],
            delegatedTasks: [],
            currentTab: 'personal',
            apiUrl: 'https://yavibetodo-telegram-bot.onrender.com/api'
        };

        document.addEventListener('DOMContentLoaded', async () => {
            if (app.tg) {
                app.tg.ready();
                app.tg.expand();
            }
            await loadUser();
        });

        /* ... –≤–µ—Å—å —Ç–≤–æ–π JS (loadUser, renderApp, saveTodo –∏ —Ç.–¥.) ... */
    </script>
</body>
</html>
